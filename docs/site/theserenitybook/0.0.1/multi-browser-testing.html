<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Working with multiple browsers :: The Serenity BDD Book</title>
    <meta name="generator" content="Antora 1.0.1">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">The Serenity BDD Book</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <a class="navbar-item" href="https://github.com/serenity-bdd/serenity-core/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/serenity-bdd/serenity-core">Source Code on Github</a>
        <a class="navbar-item" href="https://johnfergusonsmart.com/serenity-bdd-mentoring/">Serenity Support</a>
        <a class="navbar-item" href="https://serenitydojo.teachable.com">Serenity Online Training</a>

        <!-- <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div> -->
        <!-- <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div> -->
      </div>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="theserenitybook" data-version="0.0.1">
  <aside class="navigation" role="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">The Serenity Book</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Serenity BDD Fundamentals</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Introduction to Serenity BDD</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="getting-started.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="first-steps.html">First Steps</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="step-libraries.html">Working with Step Libraries</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Testing Web Applications</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="angularjs.html">Testing AngularJS applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">The Screenplay Pattern</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-screenplay-rest.html">REST API Tesing with Screenplay</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Reporting and Living documentation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="living-documentation.html">Living Documentation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="glossary.adoc">Glossary</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">The Serenity Book</span>
    <span class="version">0.0.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">The Serenity Book</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">0.0.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main" role="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
<nav class="crumbs" role="navigation" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="index.html">The Serenity Book</a></li>
    <li class="crumb"><a href="multi-browser-testing.html">Working with multiple browsers</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/serenity-bdd/the-serenity-book/edit/master/modules/ROOT/pages/multi-browser-testing.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1>Working with multiple browsers</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Some web tests need to exercise two different browsers simultaneously. Workflow applications are a good example of this scenario: imagine for example a scenario where one user (say, a salesperson) raises an expense and another user (his or her manager) needs to approve this expense in a different session.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_do_you_need_to_use_multiple_browsers"><a class="anchor" href="#_do_you_need_to_use_multiple_browsers"></a>Do you need to use multiple browsers?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before you go down this path, there are often ways to avoid the use of two browsers in such scenarios. For example, suppose you need to automate the following scenario:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Scenario: Expenses over $1000 need to be reviewed by a manager
Joe and Jane a sales people and Mark is their manager

Given Joe has raised an expenses claim for $1200
And Jane has raised an expenses claim for $900
When he submits his claim for processing
Then Mark should see the following expense claims in his inbox:
| Employee | Claim |
| Joe      | $1200 |</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this scenario, three actors are involved: Joe, Jane and Mark. You could test this using three browsers, one for each user. Or, knowing that the expense claim UI is tested elsewhere, you could invoke a web service to inject the claims directly into the system, and use a single web test for Mark, when he views his inbox. <em>Or</em> you could dispense with web testing entirely, and use another web service to query Mark&#8217;s inbox. There are often many ways to test a scenario.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_when_you_really_do_need_to_use_multiple_browsers"><a class="anchor" href="#_when_you_really_do_need_to_use_multiple_browsers"></a>When you really do need to use multiple browsers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nevertheless, there are cases where you really do need multiple browsers in the same test. Suppose you have the following (rather silly) test case:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Scenario: Users are stubborn about their browser choice
    Given Joe likes firefox
    And Jane prefers chrome
    When Joe looks for foxes
    And Jane looks for fenders
    Then Joe should see mammals
    And Jane should see shiny stuff</code></pre>
</div>
</div>
<div class="paragraph">
<p>The interesting thing here is that we have two actors, each using a different browser. How could you implement this test in Serenity?</p>
</div>
<div class="sect2">
<h3 id="_using_screenplay"><a class="anchor" href="#_using_screenplay"></a>Using Screenplay</h3>
<div class="paragraph">
<p>Multiple browsers are easy to manage in Screenplay. In this case, you could just declare two browsers, and assign each of them to a different user, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class StepDefinitions {

    @Managed(driver = "firefox")
    WebDriver firefox;

    @Managed(driver = "chrome")
    WebDriver chrome;

    Actor joe = Actor.named("Joe");
    Actor jane = Actor.named("Jane");

    @Given("^Joe (?:likes|prefers) firefox$")
    public void joeLikesFirefox() throws Throwable {
        joe.can(BrowseTheWeb.with(firefox));
    }

    @And("^Jane (?:likes|prefers) chrome$")
    public void janeLikeChrome() throws Throwable {
        jane.can(BrowseTheWeb.with(chrome));
    }
	...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then Joe and Jane will use Firefox and Chrome respectively for their subsequent web interactions.</p>
</div>
<div class="paragraph">
<p>One nice thing about this approach is that, once the driver is assigned to an actor, any UI interaction will use that driver, no matter what order the calls are made. So the following code will use Chrome or Firefox, depending on whether the actor in question is Jane or Joe:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">	actor.attemptsTo(Open.url("https://www.google.co.uk"));
	actor.attemptsTo(
			Enter.theValue(search).into(By.name("q"))
			 	 .thenHit(Keys.ENTER)
);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_managed_drivers"><a class="anchor" href="#_using_managed_drivers"></a>Using @Managed drivers</h3>
<div class="paragraph">
<p>The @Managed field can be used to declare drivers of specific types, in both JUnit tests and Cucumber step definitions. The driver you declare in this annotation will override any drivers declared in the <code>serenity.properties</code> file, and you can use the <code>option</code> attribute to pass in Chrome options, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Managed(driver = "chrome", options = "--headless")
WebDriver chrome;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_obtaining_drivers_dynamically"><a class="anchor" href="#_obtaining_drivers_dynamically"></a>Obtaining drivers dynamically</h3>
<div class="paragraph">
<p>Sometimes you need a solution more dynamic than defining the drivers ahead of time with the <code>@Managed</code> annotation. In this case, you can use the Serenity <code>ThucydidesWebDriverSupport</code> class to allocate a dynamically driver by name.</p>
</div>
<div class="paragraph">
<p>For example, suppose you have the following Gherkin statement, where the browser name may vary:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Given Joe likes to browse with firefox</code></pre>
</div>
</div>
<div class="paragraph">
<p>Probably the best way to make both the actor (Joe) and the browser (firefox) dynamic is to use the <code>OnlineCast</code> class. The <code>OnlineCast</code> class represents the cast of actors we can call on to perform our web-based tests.</p>
</div>
<div class="paragraph">
<p>In practice, we can do this by creating an <code>OnlineCast</code> object and use it to create actors who can browse the web with a browser of a specified type. You can see an example of this in the following listing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">OnlineCast theCast = new OnlineCast(); 	(1)

@Before
public void setTheStage() {
	OnStage.setTheStage(theCast);		(2)
}

@Given("^(.*) likes to browse with (.*)")
public void joeBrowsesTheWebWith(String actorName, String driverType) throws Throwable {
	Actor actor = theCast.actorUsingBrowser(driverType).named(actorName);	(3)

	actor.attemptsTo(Open.url("https://www.google.co.uk"));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>(1) Create a new cast
(2) Set the cast so that we can refer to actors later on using <code>theActorCalled()</code> and <code>theActorInTheSpotlight()</code>
(3) Retrieve an actor using a given browser with a given name</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_obtaining_drivers_from_the_webdrivermanager"><a class="anchor" href="#_obtaining_drivers_from_the_webdrivermanager"></a>Obtaining drivers from the WebDriverManager</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Another alternative is to retrieve the <code>WebDriver</code> instance from the Serenity <code>WebDriverManager</code> class. This class keeps track of all the open drivers, and you can retrieve a driver either by it&#8217;s type (e.g. "firefox"), or in conjunction with a unique name. If you provide the unique name, you can have several browsers of the same type simultaneously in the same test.</p>
</div>
<div class="paragraph">
<p>For example, the following code retrieves a Firefox instance associated with "joe":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">WebDriver driver = ThucydidesWebDriverSupport.getWebdriverManager()
                                             .getWebdriverByName("joe", "firefox");</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method can be called from anywhere in the test suite.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_multiple_browsers_with_screenplay_and_legacy_page_object_classes"><a class="anchor" href="#_using_multiple_browsers_with_screenplay_and_legacy_page_object_classes"></a>Using multiple browsers with Screenplay and legacy Page Object classes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes you need to use multiple browsers with test code that uses non-Screenplay page objects. You can do this quite easily, by extracting the WebDriver from the actor. For example, suppose you have a page that opens the Google home page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@DefaultUrl("https://www.google.co.uk")
public static class GooglePage extends PageObject {
	public GooglePage(WebDriver driver) {
		super(driver);
	}
	...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A simple way to access this class is to wrap it in a <code>Task</code> class, like the one shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static class OpenGoogle implements Task {
	@Override
	public &lt;T extends Actor&gt; void performAs(T actor) {
		GooglePage page = new GooglePage(BrowseTheWeb.as(actor).getDriver());
		page.open();
	}

	public static OpenGoogle homePage() {
		return instrumented(OpenGoogle.class);
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A Screenplay actor can then open this page, with the corresponding driver instance, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">actor.attemptsTo(OpenGoogle.homePage());</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_managed_annotation_for_remote_drivers"><a class="anchor" href="#_using_the_managed_annotation_for_remote_drivers"></a>Using the @Managed annotation for Remote drivers</h3>
<div class="paragraph">
<p>Selenium Grid, as well as services like BrowserLabs and SauceSafe, offer a convenient way to scale your web tests by running them on batteries of remote machines. In Serenity, you can run your tests on a remote server simply by specifying the <code>webdriver.remote.url</code> property in your <code>serenity.properties</code> file or on the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>webdriver.remote.url=http://localhost:4444/wd/hub</pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the <code>saucelabs.url</code> or <code>browserstack.url</code> properties to work with one of these services.</p>
</div>
<div class="paragraph">
<p>As soon as you set a remote url, Serenity will use a Remote driver. However Serenity will still respect your choice of browsers on the remote server. For example, suppose you run a test with the following @Managed driver:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Managed(driver = "chrome", options = "--headless")
WebDriver driver;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use a remote url, a Chrome driver will be used on the remote server.</p>
</div>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
