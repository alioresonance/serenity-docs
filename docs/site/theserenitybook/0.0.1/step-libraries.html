<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Serenity Step Libraries :: The Serenity BDD Book</title>
    <meta name="generator" content="Antora 1.0.1">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">The Serenity BDD Book</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <a class="navbar-item" href="https://github.com/serenity-bdd/serenity-core/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/serenity-bdd/serenity-core">Source Code on Github</a>
        <a class="navbar-item" href="https://johnfergusonsmart.com/serenity-bdd-mentoring/">Serenity Support</a>
        <a class="navbar-item" href="https://serenitydojo.teachable.com">Serenity Online Training</a>

        <!-- <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div> -->
        <!-- <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div> -->
      </div>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="theserenitybook" data-version="0.0.1">
  <aside class="navigation" role="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">The Serenity Book</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Serenity BDD Fundamentals</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Introduction to Serenity BDD</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="getting-started.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="first-steps.html">First Steps</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="step-libraries.html">Working with Step Libraries</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Testing Web Applications</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="angularjs.html">Testing AngularJS applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">The Screenplay Pattern</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="serenity-screenplay-rest.html">REST API Tesing with Screenplay</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Reporting and Living documentation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="living-documentation.html">Living Documentation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="glossary.adoc">Glossary</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">The Serenity Book</span>
    <span class="version">0.0.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">The Serenity Book</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">0.0.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main" role="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
<nav class="crumbs" role="navigation" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="index.html">The Serenity Book</a></li>
    <li class="crumb">Serenity BDD Fundamentals</li>
    <li class="crumb"><a href="step-libraries.html">Working with Step Libraries</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/serenity-bdd/the-serenity-book/edit/master/modules/ROOT/pages/step-libraries.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1>Serenity Step Libraries</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In Serenity, tests are broken down into reusable steps. An important principle behind Serenity is the idea that it is easier to maintain a test that uses several layers of abstraction to hide the complexity behind different parts of a test.</p>
</div>
<div class="paragraph">
<p>In an automated acceptance test, test steps represent the level of abstraction between the code that interacts with your application (for example, Page Objects in an automated web test, which are designed in terms of actions that you perform on a given page) and higher-level stories (sequences of more business-focused actions that illustrate how a given user story has been implemented). If your automated test is not UI-oriented (for example, if it calls a web service), steps orchestrate other more technical components such as REST clients. Steps can contain other steps, and are included in the Serenity reports. Whenever a step is executed, a screenshot is stored and displayed in the report.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_breaking_down_tests_into_steps"><a class="anchor" href="#_breaking_down_tests_into_steps"></a>Breaking down tests into steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Suppose we are testing a Frequent Flyer programme, and need to illustrate the following business rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Members should start with Bronze status</p>
</li>
<li>
<p>Members should earn Silver status after flying 10,000 km.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of these can be broken down further into business tasks and verifications. For example, the first rule could be broken into two steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new Frequent Flyer member</p>
</li>
<li>
<p>Check that the member has a status of Bronze</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>And the second can be broken into three steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new Frequent Flyer member</p>
</li>
<li>
<p>Make the member fly 10000 km</p>
</li>
<li>
<p>Check that the member has a status of Silver</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We could express these tests using Serenity in JUnit as follows:</p>
</div>
<div class="paragraph">
<p>[import:'classbody'](../samples/frequent-flyer/src/test/java/flyer/WhenEarningFrequentFlyerStatus.java)</p>
</div>
<div class="paragraph">
<p>Notice how the second test reuses step methods used in the first to perform a slightly different test. This is a typical example of the way we reuse steps in similar tests, in order to avoid duplicated code and make the code easier to maintain.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementing_step_libraries"><a class="anchor" href="#_implementing_step_libraries"></a>Implementing Step Libraries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>WhenEarningFrequentFlyerStatus</code> class is what we call a <em>step library</em>. We use the <code>@Steps</code> class as shown above to indicate a step library in our test code: this annotation tells Serenity to instantiate and instrument this field, so that methods you call in this library also appear in the test reports, just like in the one you can see here:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/earn-silver-after-10000-km.png" alt="earn silver after 10000 km">
</div>
</div>
<div class="paragraph">
<p>Step libraries contain the business tasks or actions that a user performs during a test. There are many ways to organise your step libraries, but a convenient way is to group methods in slices of business behaviour for a given type of user. In this case a <em>traveller</em> who is <em>earning status points</em>.</p>
</div>
<div class="paragraph">
<p>Notice how we did not need to instantiate the <code>Steps</code> class <code>TravellerEarningStatusPoints</code>. When you annotated a member variable of this class with the <code>@Steps</code> annotation, Serenity BDD will automatically instantiate it for you.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You should never create instances of step libraries using the <code>new</code> keyword, as Serenity will not be able to instrument the step library correctly, and the methods called will not appear in the reports.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Step methods are annotated with the @Step annotation:</p>
</div>
<div class="paragraph">
<p>[import:'classbody'](../samples/frequent-flyer/src/test/java/flyer/steps/TravellerEarningStatusPoints.java)</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Steps classes can extend any class, or none</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If you include an <code>actor</code> field in your step library, Serenity will inject the name of the step.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The @Step annotation denotes a Serenity step method</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The @Step can take a String value to override the default step name</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>{0} indicates the first parameter of the step method. #name indicates the name field of the step library.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>One of the keys to writing good tests is getting the layers right. Test suites are more maintainable when they are organised in clear, well defined layers. This helps our brain concentrate on one thing at a time.</p>
</div>
</div>
</div>
<h1 id="_step_libraries_and_personas" class="sect0"><a class="anchor" href="#_step_libraries_and_personas"></a>Step libraries and personas</h1>
<div class="paragraph">
<p>Step libraries are often used to represent actors or persona who interact with the application. For example, the <code>TravellerEarningStatusPoints</code> step library we saw earlier represents how a Frequent Flyer member earns status points.</p>
</div>
<div class="paragraph">
<p>Methods that represent a business task or action (<code>joins_the_frequent_flyer_program()</code>), and that will appear in the reports as a separate step, are annotated with the <code>@Step</code> annotation.</p>
</div>
<div class="paragraph">
<p>[import:'joins'](../samples/frequent-flyer/src/test/java/flyer/steps/TravellerEarningStatusPoints.java)</p>
</div>
<div class="paragraph">
<p>Notice how the <code>@Step</code> attribute has a string value. This tells Serenity what to write in the reports when this step is executed. You don&#8217;t need a value (if you don&#8217;t have one, the name of the method will be used instead). But you can use this value to make your step names more meaningful.</p>
</div>
<div class="paragraph">
<p>If you add an <code>actor</code> field to your step library, Serenity will inject the name of the <code>@Steps</code> variable into this field. You can then refer to it in the @Step annotation using the <code>#</code> notation that we saw earlier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Step("#actor joins the frequent flyer program")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Suppose we declare a step library like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Steps
TravellerEarningStatusPoints tracy;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the name "Tracy" would be injected into the <code>actor</code> field, and the step description would become "Tracy joins the frequent flyer program"</p>
</div>
<div class="paragraph">
<p>You can also provide a more detailed name in the @Steps annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Steps("Tracy Jones")
TravellerEarningStatusPoints tracy;</code></pre>
</div>
</div>
<div class="paragraph">
<p>@Step methods can also take parameters, as we saw for the <code>flies()</code> and <code>should_have_a_status_of()</code> methods. You can refer to these in your step description using an indexed notation starting at zero: <code>{0}</code> for the first parameter, <code>{1}</code> for the second, and so on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Step("#actor flies {0} km")
public void flies(int distance) {...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step would appear in the Serenity reports as "Tracy flies 10000 km".</p>
</div>
<div class="sect1">
<h2 id="_using_several_step_libraries_to_represent_different_actors"><a class="anchor" href="#_using_several_step_libraries_to_represent_different_actors"></a>Using several step libraries to represent different actors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes we can use several step libraries of the same type to make our tests more readable. For example, the following test shows how point transfers between different travellers works.</p>
</div>
<div class="paragraph">
<p>[import:'classbody'](../samples/frequent-flyer/src/test/java/flyer/WhenTransferringFrequentFlyerPoints.java)</p>
</div>
<div class="paragraph">
<p>This would produce a report where both actors (Tracy and Troy) appear in different roles:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/tracy-and-troy.png" alt="tracy and troy">
</div>
</div>
<div class="paragraph">
<p>Note that a more elegant way to do this is by using the Screenplay pattern, where each actor can have their own browser and abilities.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_shared_instances_of_step_libraries"><a class="anchor" href="#_shared_instances_of_step_libraries"></a>Shared Instances of Step Libraries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are some cases where we want to reuse the same step library instance in different places across a test. For example, suppose we have a step library that interacts with a backend API, and that maintains some internal state and caching to improve performance. We might want to reuse a single instance of this step library, rather than having a separate instance for each variable.</p>
</div>
<div class="paragraph">
<p>We can do this by declaring the step library to be <em>shared</em>, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Steps(shared = true)
CustomerAPIStepLibrary customerAPI;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, any other step libraries of type <code>CustomerAPIStepLibrary</code>, that have the <code>shared</code> attribute set to true will refer to the same instance.</p>
</div>
<div class="paragraph">
<p>In older versions of Serenity, sharing instances was the default behaviour, and you used the <code>uniqueInstance</code> attribute to indicate that a step library should <em>not</em> be shared. If you need to force this behaviour for legacy test suites, set the <code>step.creation.strategy</code> property to <code>legacy</code> in your <code>serenity.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>step.creation.strategy = legacy</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sharing_instances_using_the_shared_annotation"><a class="anchor" href="#_sharing_instances_using_the_shared_annotation"></a>Sharing instances using the @Shared annotation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can also use the <code>@Shared</code> annotation to share objects between steps and tasks in your test.
The <code>@Shared</code> annotation is in practical terms a shortcut for <code>@Steps(shared=true)</code>. This is handy in Screenplay tests, where the <code>@Shared</code> annotation reflects the intention more accurately than the <code>@Steps</code> annotation.</p>
</div>
<div class="paragraph">
<p>For example, suppose you have a Screenplay task that you use to set up some reference data that you want to share between steps. You could set them up in a special task called <code>PrepareReferenceTestData</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">givenThat(dana).wasAbleTo(PrepareReferenceTestData.inTheTestEnvironment());</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>PrepareReferenceTestData</code> class would prepare test data and place the data in a Java class (say <code>ReferenceData</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class PrepareReferenceTestData implements Task {
    public static Performable inTheTestEnvironment() {
            return instrumented(PrepareSomeCommonData.class);
    }

    @Shared
    ReferenceData referenceData;

    @Override
    public &lt;T extends Actor&gt; void performAs(T actor) {
        // Prepare reference data used in several tasks in a shared class
        referenceData = ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any other <code>Task</code>, <code>Interaction</code> or <code>Question</code> class can then refer to the reference data, simply by declaring a shared field of type <code>ReferenceData</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Shared
ReferenceData referenceData;</code></pre>
</div>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
